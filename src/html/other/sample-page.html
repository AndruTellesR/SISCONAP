<!DOCTYPE html>
<html lang="en">
<!-- [Head] start -->

<head>
  @@include('../layouts/head-page-meta.html', {'title': 'Sample Page'}) @@include('../layouts/head-css.html')
</head>
<!-- [Head] end -->
<!-- [Body] Start -->

<body @@bodySetup>
  @@include('../layouts/layout-vertical.html')

  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
      @@include('../layouts/breadcrumb.html', {'breadcrumb-item': 'Other', 'breadcrumb-item-active': 'Sample Page'})

      <!-- [ Main Content ] start -->
      <div class="row">
        <!-- [ sample-page ] start -->
        <div class="col-sm-12">
          <div class="card">
            <div class="card-header">
              <h5>Hello card</h5>
            </div>
            <div class="card-body">
              <h5>Lista de Rubros Presupuestales</h5>
              <table class="table table-striped table-bordered">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Monto Inicial</th>
                  </tr>
                </thead>
                <tbody id="rubros-table-body">
                  <!-- Las filas de datos se insertarán aquí por JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- [ sample-page ] end -->
      </div>
      <!-- [ Main Content ] end -->
    </div>
  </div>
  <!-- [ Main Content ] end -->
  @@include('../layouts/footer-block.html') @@include('../layouts/footer-js.html')
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const tableBody = document.getElementById('rubros-table-body');

      fetch('http://localhost:8000/api/presupuesto/rubros/')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          if (!tableBody) {
            console.error('Error: Elemento #rubros-table-body no encontrado.');
            return;
          }
          tableBody.innerHTML = ''; // Limpiar cualquier contenido previo (ej. mensaje de carga)
          if (data.length === 0) {
            const row = tableBody.insertRow();
            const cell = row.insertCell();
            cell.colSpan = 4;
            cell.textContent = 'No hay rubros para mostrar.';
            cell.style.textAlign = 'center';
          } else {
            data.forEach(rubro => {
              const row = tableBody.insertRow();
              row.insertCell().textContent = rubro.id;
              row.insertCell().textContent = rubro.codigo;
              row.insertCell().textContent = rubro.nombre;
              // Formatear monto_inicial si es necesario, ej. a moneda
              const montoCell = row.insertCell();
              montoCell.textContent = parseFloat(rubro.monto_inicial).toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
              montoCell.style.textAlign = 'right'; 
            });
          }
        })
        .catch(error => {
          console.error('Error al obtener los rubros:', error);
          if (tableBody) {
            tableBody.innerHTML = ''; // Limpiar
            const row = tableBody.insertRow();
            const cell = row.insertCell();
            cell.colSpan = 4;
            cell.textContent = 'Error al cargar los datos. Verifique la consola.';
            cell.style.textAlign = 'center';
            cell.style.color = 'red';
          }
        });
    });
  </script>
</body>
<!-- [Body] end -->

</html>